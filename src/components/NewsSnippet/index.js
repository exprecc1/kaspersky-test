import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from 'react';
import { Button, Card, Tag, Typography, Checkbox } from 'antd';
import { GlobalOutlined, UserOutlined, BookOutlined, DownOutlined, UpOutlined, } from '@ant-design/icons';
import { useSelector } from 'react-redux';
import { useAppDispatch } from '../../store/store';
import { toggleFavorite } from '@/store/newsSlice';
import { formatDate, formatReach } from '../../utils/newsUtils';
import './NewsSnippet.scss';
import { WarningIcon } from '@/shared/ui/icons/warning-icon';
const { Text, Paragraph, Title } = Typography;
// Компонент для выделения ключевых слов
const HighlightedText = ({ text }) => {
    const parts = text.split(/(<kw>.*?<\/kw>)/g);
    return (_jsx(_Fragment, { children: parts.map((part, index) => part.startsWith('<kw>') && part.endsWith('</kw>') ? (_jsx("span", { className: "highlighted-keyword", children: part.replace(/<\/?kw>/g, '') }, index)) : (part)) }));
};
const NewsSnippet = ({ data }) => {
    const dispatch = useAppDispatch();
    const [showFullText, setShowFullText] = useState(false);
    const [showAllTag, setShowAllTag] = useState(false);
    const { newsList, favorites } = useSelector((state) => state.news);
    //Переключатель избранноого
    const handleToggleFavorite = (id) => {
        dispatch(toggleFavorite(id));
    };
    // Фильтруем связанные новости по ID
    const relatedNews = newsList.filter((news) => news.ID === data.ID);
    return (_jsxs(Card, { className: "news-card", children: [_jsxs("div", { className: "snippet-header", children: [_jsxs("div", { className: "header-left", children: [_jsxs(Text, { type: "secondary", className: "meta-item", children: [_jsx("span", { className: "meta-value", children: formatDate(data.DP).split(' ')[0] }), _jsx("span", { children: formatDate(data.DP).split(' ').slice(1).join(' ') })] }), _jsxs(Text, { type: "secondary", className: "meta-item", children: [_jsx("span", { className: "meta-value", children: formatReach(data.REACH) }), " ", _jsx("span", { children: "Reach" })] }), _jsxs(Text, { type: "secondary", className: "meta-item", children: [_jsx("span", { children: "Top Traffic: " }), data.TRAFFIC.slice(0, 3).map((item, index) => (_jsxs("span", { children: [item.value, " ", _jsxs("span", { className: "traffic-value", children: [Math.round(item.count * 100), "%"] }), index < data.TRAFFIC.slice(0, 3).length - 1] }, item.value)))] })] }), _jsxs("div", { className: "header-right", children: [_jsx(Button, { variant: "solid", className: "meta-btn", children: "Positive" }), _jsx(Text, { type: "secondary", className: "meta-item", children: _jsx(WarningIcon, { className: "icon-warning" }) }), _jsx(Text, { type: "secondary", className: "meta-item", children: _jsx(Checkbox, { className: "check-box", checked: favorites.includes(data.ID), onChange: () => handleToggleFavorite(data.ID) }) })] })] }), _jsx(Title, { level: 5, className: "news-title", children: _jsx("a", { href: data.URL, target: "_blank", rel: "noopener noreferrer", children: data.TI }) }), _jsxs("div", { className: "source-info", children: [_jsxs(Text, { type: "secondary", className: "source-item", children: [_jsxs("span", { children: [_jsx(GlobalOutlined, {}), ' '] }), _jsx("a", { href: `https://${data.URL}`, target: "_blank", children: data.DOM })] }), _jsx(Text, { type: "secondary", className: "source-item", children: _jsx("span", { children: data.CNTR }) }), _jsx(Text, { type: "secondary", className: "source-item", children: _jsxs("span", { children: [_jsx(BookOutlined, {}), " ", data.LANG.toUpperCase()] }) }), data.AU?.length > 0 && (_jsx(Text, { type: "secondary", className: "source-item", children: _jsxs("span", { children: [_jsx(UserOutlined, {}), " ", data.AU.join(', ')] }) }))] }), _jsxs(Paragraph, { className: `news-abstract ${showFullText ? 'expanded' : 'collapsed'}`, children: [data.AB, _jsx(HighlightedText, { text: data.HIGHLIGHTS.join(' ') })] }), _jsxs(Text, { type: "secondary", className: "show-item", onClick: () => setShowFullText(!showFullText), children: [_jsx("span", { children: "Show More" }), " ", showFullText ? _jsx(UpOutlined, {}) : _jsx(DownOutlined, {})] }), _jsxs("div", { className: "tags-container", children: [(showAllTag ? data.KW : data.KW.slice(0, 3)).map((tag, index) => (_jsx(Tag, { className: index === 0 ? 'main-tag' : 'tag', children: _jsxs("span", { children: [' ', tag.value, " ", tag.count >= 1 && tag.count] }) }, tag.value))), data.KW.length > 3 && !showAllTag && (_jsx(Tag, { className: "more-tags", onClick: () => setShowAllTag(true), children: _jsxs("span", { children: ["Show All +", data.KW.length - 3] }) }))] }), _jsx("div", { className: "news-footer", children: _jsxs(Text, { type: "secondary", className: "dublicate-text", children: ["\u0414\u0443\u0431\u043B\u0438\u043A\u0430\u0442\u044B: ", _jsx("span", { children: "192" })] }) }), relatedNews.map((news) => (_jsxs(Card, { className: "related-news", children: [_jsxs("div", { className: "snippet-header", children: [_jsxs("div", { className: "header-left", children: [_jsxs(Text, { type: "secondary", className: "meta-item", children: [_jsx("span", { className: "meta-value", children: formatDate(data.DP).split(' ')[0] }), _jsx("span", { children: formatDate(data.DP).split(' ').slice(1).join(' ') })] }), _jsxs(Text, { type: "secondary", className: "meta-item", children: [_jsx("span", { className: "meta-value", children: formatReach(data.REACH) }), " ", _jsx("span", { children: "Reach" })] })] }), _jsxs("div", { className: "header-right", children: [_jsx(Text, { type: "secondary", className: "meta-item", children: _jsx(WarningIcon, { className: "icon-warning" }) }), _jsx(Text, { type: "secondary", className: "meta-item", children: _jsx(Checkbox, { className: "check-box" }) })] })] }), _jsx(Title, { level: 5, children: _jsx("a", { href: news.URL, target: "_blank", children: news.TI }) }), _jsxs("div", { className: "source-info", children: [_jsxs(Text, { type: "secondary", className: "source-item", children: [_jsxs("span", { children: [_jsx(GlobalOutlined, {}), ' '] }), _jsx("a", { href: `https://${data.URL}`, target: "_blank", children: data.DOM })] }), _jsx(Text, { type: "secondary", className: "source-item", children: _jsx("span", { children: data.CNTR }) }), _jsx(Text, { type: "secondary", className: "source-item", children: _jsxs("span", { children: [_jsx(BookOutlined, {}), " ", data.LANG.toUpperCase()] }) }), data.AU?.length > 0 && (_jsx(Text, { type: "secondary", className: "source-item", children: _jsxs("span", { children: [_jsx(UserOutlined, {}), " ", data.AU.join(', ')] }) }))] })] }, news.ID))), _jsxs(Button, { variant: "outlined", className: "footer-btn", children: [_jsx(DownOutlined, {}), " View Dublicates"] })] }));
};
export default NewsSnippet;
